<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server_script2.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server_script2.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { createServer } from 'http';
import { readFile, appendFile } from 'fs';
import { join,dirname } from 'path';
import { URLSearchParams,fileURLToPath } from 'url';

const PORT = 8000;
const __dirname = dirname(fileURLToPath(import.meta.url));
const FILE = join(__dirname, '../entries.txt');

/**
 * Generuje stronę HTML z wpisami i formularzem.
 * @param {string} entriesHtml - Sformatowane wpisy w HTML.
 * @returns {string} Kod HTML strony.
 */
function renderPage(entriesHtml) {
    return `
&lt;!DOCTYPE html>
&lt;html lang="pl">
&lt;head>
    &lt;meta charset="UTF-8">
    &lt;title>Księga gości&lt;/title>
&lt;/head>
&lt;body>
    &lt;h1>Księga gości&lt;/h1>
    &lt;h2>Poprzednie wpisy:&lt;/h2>
    &lt;div>${entriesHtml}&lt;/div>
    &lt;hr>
    &lt;h2>Dodaj nowy wpis&lt;/h2>
    &lt;form method="POST" action="/">
        &lt;label>Imię i nazwisko:&lt;br>&lt;input type="text" name="name" required>&lt;/label>&lt;br>&lt;br>
        &lt;label>Treść wpisu:&lt;br>&lt;textarea name="message" rows="5" cols="40" required>&lt;/textarea>&lt;/label>&lt;br>&lt;br>
        &lt;button type="submit">Wyślij&lt;/button>
    &lt;/form>
&lt;/body>
&lt;/html>
    `;
}
/**
 * Formatuje surowe dane z pliku na HTML.
 * @param {string} rawData - Surowe dane z pliku tekstowego.
 * @returns {string} Sformatowane wpisy w HTML.
 */
function formatEntries(rawData) {
    if (!rawData) return '&lt;i>Brak wpisów.&lt;/i>';
    return rawData
        .split('\n')
        .filter(line => line.trim() !== '')
        .map(line => {
            const [name, message] = line.split('||');
            return `&lt;p>&lt;strong>${name}&lt;/strong>: ${message}&lt;/p>`;
        })
        .join('');
}


/**
 * Serwer HTTP obsługujący księgę gości.
 * Obsługuje żądania GET (wyświetlanie wpisów) i POST (dodawanie wpisu).
 */
const server = createServer((req, res) => {
    if (req.method === 'GET' &amp;&amp; req.url === '/') {
        readFile(FILE, 'utf-8', (err, data) => {
            const entriesHtml = formatEntries(data);
            const html = renderPage(entriesHtml);
            res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });
            res.end(html);
        });
    } else if (req.method === 'POST' &amp;&amp; req.url === '/') {
        let body = '';
        req.on('data', chunk => {
            body += chunk.toString();
        });
        req.on('end', () => {
            const params = new URLSearchParams(body);
            const name = params.get('name')?.trim().replace(/\|{2,}/g, '|') || 'Anonim';
            const message = params.get('message')?.trim().replace(/\|{2,}/g, '|') || '';
            if (name &amp;&amp; message) {
                const entry = `${name}||${message}\n`;
                appendFile(FILE, entry, err => {
                    if (err) {
                        res.writeHead(500, { 'Content-Type': 'text/plain' });
                        res.end('Błąd zapisu do pliku.');
                    } else {
                        res.writeHead(302, { Location: '/' });
                        res.end();
                    }
                });
            } else {
                res.writeHead(400, { 'Content-Type': 'text/plain' });
                res.end('Nieprawidłowe dane.');
            }
        });
    } else {
        res.writeHead(404, { 'Content-Type': 'text/plain' });
        res.end('Nie znaleziono');
    }
});

/**
 * Uruchamia serwer na zadanym porcie.
 */
server.listen(PORT, () => {
    console.log(`Serwer działa na http://localhost:${PORT}/`);
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#formatEntries">formatEntries</a></li><li><a href="global.html#renderPage">renderPage</a></li><li><a href="global.html#requestListener">requestListener</a></li><li><a href="global.html#server">server</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Tue May 20 2025 17:04:59 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
